"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var express_1 = require("express");
var chatRouter = (0, express_1.Router)();
var ChatRepository_1 = __importDefault(require("../../infrastructure/repositories/ChatRepository"));
var MessageRepository_1 = __importDefault(require("../../infrastructure/repositories/MessageRepository"));
var CreateChatUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/CreateChatUseCase"));
var SendMessageUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/SendMessageUseCase"));
var GetAllChatsUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/GetAllChatsUseCase"));
var ChatController_1 = __importDefault(require("../controllers/chat-controller/ChatController"));
var FindChatUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/FindChatUseCase"));
var GetByUserIdAndCourseId_1 = __importDefault(require("../../core/use-cases/chat-usecases/GetByUserIdAndCourseId"));
var MarkAsReadUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/MarkAsReadUseCase"));
var JwtService_1 = require("../../infrastructure/external-services/JwtService");
var authMiddleware_1 = require("../middleware/authMiddleware");
var UserRepository_1 = require("../../infrastructure/repositories/UserRepository");
var GetUserDetailsUseCase_1 = require("../../core/use-cases/user-usecases/GetUserDetailsUseCase");
var GetStudentListUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/GetStudentListUseCase"));
var LastMessageUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/LastMessageUseCase"));
var UnreadCountUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/UnreadCountUseCase"));
var GetUnreadCountByChatUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/GetUnreadCountByChatUseCase"));
var ClearUnreadMessageCountUseCase_1 = __importDefault(require("../../core/use-cases/chat-usecases/ClearUnreadMessageCountUseCase"));
var enums_1 = require("../../core/entities/misc/enums");
var chatRepository = new ChatRepository_1.default();
var messageRepository = new MessageRepository_1.default();
var userRepository = new UserRepository_1.UserRepository();
var createChatUseCase = new CreateChatUseCase_1.default(chatRepository);
var sendMessageUseCase = new SendMessageUseCase_1.default(messageRepository);
var getAllChatsUseCase = new GetAllChatsUseCase_1.default(chatRepository);
var findChatUseCase = new FindChatUseCase_1.default(messageRepository);
var markAsReadUseCase = new MarkAsReadUseCase_1.default(messageRepository);
var getByUserIdAndCourseIdUseCase = new GetByUserIdAndCourseId_1.default(chatRepository);
var getUserDetailsUseCase = new GetUserDetailsUseCase_1.GetUserDetailsUseCase(userRepository);
var getStudentList = new GetStudentListUseCase_1.default(chatRepository);
var lastMessageUseCase = new LastMessageUseCase_1.default(messageRepository);
var unreadCountUseCase = new UnreadCountUseCase_1.default(messageRepository);
var unreadCountByChatId = new GetUnreadCountByChatUseCase_1.default(messageRepository);
var clearUnreadMessageCountUseCase = new ClearUnreadMessageCountUseCase_1.default(messageRepository);
var chatController = new ChatController_1.default(createChatUseCase, sendMessageUseCase, getAllChatsUseCase, findChatUseCase, getByUserIdAndCourseIdUseCase, markAsReadUseCase, getStudentList, unreadCountUseCase, lastMessageUseCase, unreadCountByChatId, clearUnreadMessageCountUseCase);
var jwtService = new JwtService_1.JwtService();
var authMiddleware = authMiddleware_1.AuthMiddleware.create(jwtService, getUserDetailsUseCase);
var authorize = authMiddleware_1.AuthMiddleware.authorize([enums_1.UserRole.TUTOR, enums_1.UserRole.USER]);
chatRouter.get("/messages/:chatId", authMiddleware, authorize, chatController.getMessages);
chatRouter.get("/list", authMiddleware, authorize, chatController.getChatList);
chatRouter.post("/send", authMiddleware, authorize, chatController.sendMessage);
chatRouter.put("/mark-as-read", authMiddleware, authorize, chatController.markAsRead);
chatRouter.post("/video-call", authMiddleware, authorize, chatController.videoCallInvitation);
chatRouter.get("/student-list", authMiddleware, authorize, chatController.studentList);
chatRouter.get("/unread-count/:userId", authMiddleware, authorize, chatController.getUnreadMessageCount);
chatRouter.get("/last-messages/:userId", authMiddleware, authorize, chatController.getLastMessages);
chatRouter.post("/unread-count-by-chat", authMiddleware, authorize, chatController.getUnreadCountByChatId);
chatRouter.post("/clear-unread-count", authMiddleware, authorize, chatController.clearUnreadCount);
exports.default = chatRouter;
